var gmd=master_data.getInfo();gfu=(function(){return{'getMaxActCount':getMaxActCount,'getRelativePosId':getRelativePosId,'getFrontPosId':getFrontPosId,'getXYFromPosId':getXYFromPosId,'getPosCodeFromPosId':getPosCodeFromPosId,'getPosIdFromXY':getPosIdFromXY,'getDistance':getDistance,'getMaxHP':getMaxHP,'attackRangeCheck':attackRangeCheck,'isValidSuper':isValidSuper,'loadMonsterInfo':loadMonsterInfo,'getModifyMonsterId':getModifyMonsterId,'myAlertInField':myAlertInField,};function getMaxActCount(monster_id){try{var aMonsterData=gmd.m_monster[monster_id];var aCardData=gmd.m_card[aMonsterData.card_id];if(aCardData.category=='master'){return 10000;}else if(aMonsterData.skill.id==4){return 2;}else if(aMonsterData.skill.id==5){return 3;}return 1;}catch(e){return 0;}}function getRelativePosId(sPosId,df){var pos=getXYFromPosId(sPosId);pos.x+=df.x;pos.y+=df.y;return getPosIdFromXY(pos);}function getFrontPosId(sPosId){switch(sPosId){case 'enemyBack2':return 'enemyFront2';break;case 'enemyBack1':return 'enemyFront1';break;case 'enemyFront2':return 'myFront1';break;case 'enemyMaster':return 'myMaster';break;case 'enemyFront1':return 'myFront2';break;case 'myFront1':return 'enemyFront2';break;case 'myMaster':return 'enemyMaster';break;case 'myFront2':return 'enemyFront1';break;case 'myBack1':return 'myFront1';break;case 'myBack2':return 'myFront2';break;}return null;}function getXYFromPosId(sPosId){switch(sPosId){case 'enemyBack2':return{x:0,y:0};break;case 'enemyBack1':return{x:2,y:0};break;case 'enemyFront2':return{x:0,y:1};break;case 'enemyMaster':return{x:1,y:1};break;case 'enemyFront1':return{x:2,y:1};break;case 'myFront1':return{x:0,y:2};break;case 'myMaster':return{x:1,y:2};break;case 'myFront2':return{x:2,y:2};break;case 'myBack1':return{x:0,y:3};break;case 'myBack2':return{x:2,y:3};break;}return null;}function getPosCodeFromPosId(sPosId){switch(sPosId){case 'enemyBack2':return '(d)';break;case 'enemyBack1':return '(c)';break;case 'enemyFront2':return '(b)';break;case 'enemyMaster':return '(m)';break;case 'enemyFront1':return '(a)';break;case 'myFront1':return '(A)';break;case 'myMaster':return '(M)';break;case 'myFront2':return '(B)';break;case 'myBack1':return '(C)';break;case 'myBack2':return '(D)';break;}return '';}function getPosIdFromXY(p){if(p.y==0){if(p.x==0){return 'enemyBack2';}else if(p.x==2){return 'enemyBack1';}}else if(p.y==1){if(p.x==0){return 'enemyFront2';}else if(p.x==1){return 'enemyMaster';}else if(p.x==2){return 'enemyFront1';}}else if(p.y==2){if(p.x==0){return 'myFront1';}else if(p.x==1){return 'myMaster';}else if(p.x==2){return 'myFront2';}}else if(p.y==3){if(p.x==0){return 'myBack1';}else if(p.x==2){return 'myBack2';}}return '';}function getDistance(posId1,posId2){var p1=getXYFromPosId(posId1);var p2=getXYFromPosId(posId2);return Math.max(Math.abs(p1.x - p2.x),Math.abs(p1.y - p2.y));}function getMaxHP(mon){var iMaxHP=gmd.m_monster[mon.monster_id].max_hp;if(!mon.status){return iMaxHP;}if(mon.status[127]){var st=mon.status[127];iMaxHP=gmd.m_monster[st.param1].max_hp;}if(mon.status[128]){var st=mon.status[128];iMaxHP=gmd.m_monster[st.param1].max_hp;}return iMaxHP;}function attackRangeCheck(act,target){try{if(target.pos_category !='field' || !target.pos_id){return false;}if(target.standby_flg){return false;}if(act.status[113]){if(target.pos_id=='myMaster' || target.pos_id=='enemyMaster'){return false;}else{return true;}}else{var aData=gmd.m_monster[act.monster_id];var p1=getXYFromPosId(act.pos_id);var p2=getXYFromPosId(target.pos_id);switch(aData.skill.id){case 23:if(p2.y-p1.y==-1 &&(p2.x-p1.x==0 || p2.x-p1.x==-1)){return true;}else{return false;}break;case 24:if(p2.y-p1.y==-1 &&(p2.x-p1.x==0 || p2.x-p1.x==1)){return true;}else{return false;}break;default:if(getDistance(act.pos_id,target.pos_id)==1){return true;}else{return false;}break;}}return false;}catch(e){return false;}}function isValidSuper(aArgs){try{var aBefore=aArgs.aBefore;var aAfter=aArgs.aAfter;if(!aBefore || !aAfter){throw new Error('no_target');}if(aBefore.pos_category !='field' || aAfter.pos_category !='hand' || aAfter.owner !=aBefore.owner){throw new Error('invalid_target');}if(typeof aBefore.status[111] !='undefined' || typeof aBefore.status[127] !='undefined' || typeof aBefore.status[128] !='undefined'){throw new Error('invalid_target');}var cate=gmd.m_card[aAfter.card_id].category;if(cate !='super_front' && cate !='super_back'){throw new Error('not_super');}if(aArgs.check_lvup_standby && typeof aArgs.lvup_assist !='undefined'){if(aBefore.lvup_standby <=0 && aArgs.lvup_assist <=0){throw new Error('empty_lvup_cost');}}var aMonsterData=gmd.m_monster[aBefore.monster_id];if(aMonsterData.skill.id==15){return true;}var bSuper=false;$.each(aMonsterData.supers,function(i,val){if(val.card_id==aAfter.card_id){bSuper=true;return false;}});if(!bSuper){throw new Error('not_super');}}catch(e){return false;}return true;}function loadMonsterInfo(aArgs){if(!aArgs){throw new Error('argument_error');}if(!aArgs.target_monster){throw new Error('argument_error');}var targetMon=aArgs.target_monster;if(!targetMon){throw new Error('argument_error');}if(!aArgs.monster_id){aArgs.monster_id=targetMon.monster_id;if(!aArgs.monster_id){aArgs.monster_id=gmd.m_card[targetMon.card_id].monster_id;if(!aArgs.monster_id){throw new Error('argument_error');}}}if(!aArgs.pos_id){aArgs.pos_id=targetMon.pos_id;if(!aArgs.pos_id){throw new Error('argument_error');}}if(!aArgs.standby_flg){aArgs.standby_flg=false;}var mon=gmd.m_monster[aArgs.monster_id];targetMon.pos_category='field';targetMon.pos_id=aArgs.pos_id;targetMon.card_id=Number(mon.card_id);targetMon.monster_id=Number(aArgs.monster_id);targetMon.standby_flg=aArgs.standby_flg;targetMon.skill_disable_flg=0;targetMon.sort_no=0;if(typeof targetMon.lvup_standby=='undefined'){targetMon.lvup_standby=0;}if(typeof targetMon.status=='undefined'){targetMon.status={};}if(aArgs.aBefore){var bfMon=aArgs.aBefore;bfMon.next_game_card_id=targetMon.game_card_id;targetMon.before_game_card_id=Number(bfMon.game_card_id);targetMon.status={};targetMon.act_count=bfMon.act_count;targetMon.lvup_standby=bfMon.lvup_standby;$.extend(true,targetMon.status,bfMon.status);}if(aArgs.reset_hp){targetMon.hp=Number(mon.max_hp);}if(aArgs.reset_act_count){targetMon.act_count=0;}return targetMon;}function getModifyMonsterId(monster_id){var mon=gmd.m_monster[monster_id];var ret_monster_id=null;$.each(gmd.m_monster,function(i,val){if(val.monster_id==mon.monster_id){return true;}if(Number(val.card_id)!=Number(mon.card_id)){return true;}if(Number(val.lv)==Number(mon.lv)){ret_monster_id=val.monster_id;return false;}});return ret_monster_id;}var sGameInfomationMessage='';function myAlertInField(aArgs){if(aArgs.message==sGameInfomationMessage){return;}sGameInfomationMessage=aArgs.message;var param=JSON.parse(localStorage.game_settings);var bAlertPopup=parseInt(param['alert_popup']);if(typeof bAlertPopup=='undefined'){bAlertPopup=true;}$('#game_infomation_frame .info').text(sGameInfomationMessage);if(bAlertPopup && 0 < sGameInfomationMessage.length){alert(sGameInfomationMessage);}}})();gfr=(function(){var gfd;var g_base_color;return{'initMasterData':initMasterData,'actedReaction':actedReaction,'damageReaction':damageReaction,'healReaction':healReaction,'isDuplicateFieldPos':isDuplicateFieldPos,'updateActorDom':updateActorDom,'updateField':updateField,'wakeupReaction':wakeupReaction,'getGameCardId':getGameCardId,};function initMasterData(aArgs){gfd=aArgs.field_data;g_base_color=aArgs.base_color;}function updateField(aArgs){gfd=aArgs.field_data;try{var nHand={'my':0,'enemy':0,};var aPosId={'myMaster':'#myMaster','myFront1':'#myFront1','myFront2':'#myFront2','myBack1':'#myBack1','myBack2':'#myBack2','enemyMaster':'#enemyMaster','enemyFront1':'#enemyFront1','enemyFront2':'#enemyFront2','enemyBack1':'#enemyBack1','enemyBack2':'#enemyBack2',};var sMyHandHtml='';$('.lvup_ok').removeClass('lvup_ok');$('.lvup_checking').removeClass('lvup_checking');$.each(gfd.cards,function(i,val){switch(val.pos_category){case 'field':if(val.next_game_card_id){break;}var sImgSrc='/images/card/card.jpg';var sImgAlt='カードヒーロー';var sLv='?';var sLvHp='<span class="mini-font">LV</span><span class="lv">?</span>';sLvHp+='<span class="mini-font">HP</span><span class="hp">?</span>';if(!val.standby_flg){sImgSrc='/images/card/';if(gfu.getMaxActCount(val.monster_id)<=val.act_count){sImgSrc+='gray_';}sImgSrc+=gmd.m_monster[val.monster_id].image_file_name;sImgAlt=gmd.m_monster[val.monster_id].monster_name;sLv=gmd.m_monster[val.monster_id].lv;sLvHp='<span class="mini-font">LV</span><span class="lv">'+sLv+'</span>';sLvHp+='<span class="mini-font">HP</span><span class="hp">'+val.hp+'</span>';}var aEffectFlags={power:false,shield:false,magic:false,charge:false,};$.each(val.status,function(sid,aStatus){switch(Number(sid)){case 101:case 102:case 103:case 104:case 105:case 130:aEffectFlags.power=true;break;case 106:case 107:case 108:case 109:aEffectFlags.shield=true;break;case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:case 128:case 129:aEffectFlags.magic=true;break;case 100:aEffectFlags.charge=true;break;}});var sStatusEffect='';if(aEffectFlags.power){sStatusEffect+='<span class="power">P</span>';}if(aEffectFlags.shield){sStatusEffect+='<span class="shield">S</span>';}if(aEffectFlags.magic){sStatusEffect+='<span class="magic">M</span>';}if(aEffectFlags.charge){sStatusEffect+='<span class="charge">！</span>';}var bLvupOk=(function(mon){if(mon.lvup_standby <=0 && gfd.lvup_assist <=0){return false;}if(typeof mon.status !='undefined'){if(typeof mon.status[111] !='undefined'){return false;}if(typeof mon.status[127] !='undefined'){return false;}if(typeof mon.status[128] !='undefined'){return false;}}var aMonsterData=gmd.m_monster[mon.monster_id];if(aMonsterData.next_monster_id){return true;}try{$.each(gfd.cards,function(i2,vval){var bSuper=gfu.isValidSuper({aBefore:mon,aAfter:vval,});if(bSuper){throw 'super_ok';}});}catch(e){if(e=='super_ok'){return true;}else{throw e;}}return false;})(val);if(bLvupOk){$('#game_field td').addClass('lvup_checking');$('#game_field td#'+val.pos_id).addClass('lvup_ok');}else if(0 < val.lvup_standby){gfd.queues.push({actor_id:val.game_card_id,log_message:'',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1018,}],});}$('#game_field td#'+val.pos_id).html('<div class="pict">'+'<img src="'+sImgSrc+'" alt="'+sImgAlt+'"/>'+'</div>'+'<div class="param">'+sLvHp+'<br />'+sStatusEffect+'</div>');delete aPosId[val.pos_id];break;case 'hand':var sImgSrc='/images/card/'+gmd.m_card[val.card_id].image_file_name;var sImgAlt=gmd.m_card[val.card_id].card_name;nHand[val.owner]++;if(val.owner=='my'){sMyHandHtml+='<div class="hand_card" game_card_id="'+val.game_card_id+'">'+'<img src="'+sImgSrc+'" alt="'+sImgAlt+'"/>'+'</div>';}break;}});$.each(aPosId,function(i,sPosId){$(sPosId).html('<div class="pict"></div>');});$('#hand_card').html(sMyHandHtml);$('#myPlayersInfo .stone span').text(gfd.my_stone);$('#myPlayersInfo .hand span').text(nHand['my']);$('#enemyPlayersInfo .stone span').text(gfd.enemy_stone);$('#enemyPlayersInfo .hand span').text(nHand['enemy']);updateActorDom(aArgs);}catch(e){throw e;}}function updateActorDom(aArgs){if(typeof aArgs=='undefined'){aArgs={'field_data':gfd};}gfd=aArgs.field_data;try{var aCard=gfd.cards[gfd.actor.game_card_id];var aCardData=gmd.m_card[aCard.card_id];var sImageFileName=aCardData.image_file_name;var sImageAlt=aCardData.card_name;if(aCard.monster_id){sImageFileName=gmd.m_monster[aCard.monster_id].image_file_name;sImageAlt=gmd.m_monster[aCard.monster_id].monster_name;}var sImg='<img src="/images/card/'+sImageFileName+'" alt="'+sImageAlt+'" />';var sProposer='';if(aCardData.proposer){sProposer='<div class="proposer"> arranged by '+aCardData.proposer+'</div>';}var sDtlLink='<a class="blank_link" target="_blank" href="/card/detail/'+aCardData.card_id+'/">詳細</a>';var sCommandsHtml='';if(aCard.pos_category=='hand'){switch(aCardData.card_name){case 'ローテーション':gfd.actor.act_type='magic';sCommandsHtml='<div class="command_row" act_type="magic" param1="1">'+'時計回り'+'</div>'+'<div class="command_row" act_type="magic" param1="2">'+'反時計回り'+'</div>';break;case 'カードサーチ':gfd.actor.act_type='magic';sCommandsHtml='<div class="command_row" act_type="magic" param1="front">'+'前衛モンスターをサーチ'+'</div>'+'<div class="command_row" act_type="magic" param1="back">'+'後衛モンスターをサーチ'+'</div>'+'<div class="command_row" act_type="magic" param1="magic">'+'マジックをサーチ'+'</div>'+'<div class="command_row" act_type="magic" param1="super">'+'スーパーをサーチ'+'</div>';break;default:var sSelectedClass='selected_act';switch(aCardData.category){case 'monster_front':case 'monster_back':gfd.actor.act_type='into_field';sCommandsHtml='<div class="command_row into_field selected_act" act_type="into_field">'+'場に出す'+'</div>';break;case 'magic':gfd.actor.act_type='magic';sCommandsHtml='<div class="command_row magic selected_act" act_type="magic">'+'発動'+'</div>';break;case 'super_front':case 'super_back':break;}break;}}else if(aCard.pos_category=='field'){if(aArgs.game_state=='lvup_standby'){var aMonsterData=gmd.m_monster[aCard.monster_id];var sCommandName=null;if(0 < aCard.lvup_standby || 0 < gfd.lvup_assist){if(aMonsterData.next_monster_id){sCommandName='レベルアップ';}else{try{$.each(gfd.cards,function(i,val){var bSuper=gfu.isValidSuper({aBefore:aCard,aAfter:val,});if(bSuper){throw 'super_ok';}});}catch(e){if(e=='super_ok'){sCommandName='スーパーに進化';}else{throw e;}}}}if(sCommandName){sCommandsHtml='<div class="command_row" act_type="lvup">'+sCommandName+'</div>';}}else if(aArgs.game_state=='tokugi_fuuji'){aCard=gfd.cards[gfd.actor.aTargets[0].game_card_id];var mon=gmd.m_monster[aCard.monster_id];sImg='<img src="/images/card/'+mon.image_file_name+'" alt="'+sImageAlt+'" />';if(aCard.owner=='enemy' && aCard.standby_flg){throw new Error('standby monster');}$.each(mon.arts,function(i,val){var sPower='';var iPow=Number(val.power);var sRange='<img src="/images/range/'+val.range_type_id+'.png" alt="" />';var iStone=val.stone;if(val.damage_type_flg=='P' || val.damage_type_flg=='D' || val.damage_type_flg=='HP'){switch(val.script_id){case 1012:case 1013:case 1020:case 1026:sPower='?'+val.damage_type_flg;break;default:sPower=''+iPow+''+val.damage_type_flg;break;}}else if(val.script_id==1041){sPower='2?';}if(typeof aCard.status !='undefined'){if(typeof aCard.status[120] !='undefined' && aCard.status[120].param1==i){iStone *=2;}if(typeof aCard.status[123] !='undefined'){iStone+=2;}}sCommandsHtml+='<div class="command_row" art_id="'+val.id+'" act_type="arts">'+val.name+'<div class="num_info">'+'<span class="range_pic">'+sRange+'</span>'+' '+sPower+' '+'<span class="stone_cost">'+iStone+'コ'+'</span>'+'</div>'+'</div>';});}else{var mon=gmd.m_monster[aCard.monster_id];if(aCard.owner=='enemy' && aCard.standby_flg){throw new Error('standby monster');}var iPow=parseInt(mon.attack.power);var sCost='';var iStone=parseInt(mon.attack.stone);if(typeof aCard.status !='undefined'){if(typeof aCard.status[123] !='undefined'){iStone+=2;}}if(iStone > 0){sCost=' '+'<span class="stone_cost">'+iStone+'コ'+'</span>';}sCommandsHtml='<div class="command_row" act_type="attack">'+mon.attack.name+'<div class="num_info">'+iPow+'P'+sCost+'</div>'+'</div>';$.each(mon.arts,function(i,val){var sPower='';var iPow=Number(val.power);var sRange='<img src="/images/range/'+val.range_type_id+'.png" alt="" />';var iStone=val.stone;if(val.damage_type_flg=='P' || val.damage_type_flg=='D' || val.damage_type_flg=='HP'){switch(val.script_id){case 1012:case 1013:case 1020:case 1026:sPower='?'+val.damage_type_flg;break;default:sPower=''+iPow+''+val.damage_type_flg;break;}}else if(val.script_id==1041){sPower='2?';}if(typeof aCard.status !='undefined'){if(typeof aCard.status[120] !='undefined' && aCard.status[120].param1==i){iStone *=2;}if(typeof aCard.status[123] !='undefined'){iStone+=2;}}sCommandsHtml+='<div class="command_row" art_id="'+val.id+'" act_type="arts">'+val.name+'<div class="num_info">'+'<span class="range_pic">'+sRange+'</span>'+' '+sPower+' '+'<span class="stone_cost">'+iStone+'コ'+'</span>'+'</div>'+'</div>';});var sCost='';var iStone=0;if(aCard.status){if(typeof aCard.status[123] !='undefined'){iStone+=2;}}if(iStone > 0){sCost=' '+'<span class="stone_cost">'+iStone+'コ'+'</span>';}if(aCardData.category=='master'){sCommandsHtml+='<div class="command_row" act_type="make_card">'+'メイクカード'+'<div class="num_info">'+sCost+'</div>'+'</div>';}else{sCommandsHtml+='<div class="command_row" act_type="move">'+'移動'+'<div class="num_info">'+sCost+'</div>'+'</div>'+'<div class="command_row" act_type="escape">'+'逃げる'+'<div class="num_info">'+sCost+'</div>'+'</div>';}}}var sCardName=aCardData.card_name;if(aCard.monster_id){sCardName=gmd.m_monster[aCard.monster_id].name;}$('#card_info_frame').html('<div class="card_info_title clearfix">'+'<div class="card_infomation">Card Infomation</div>'+sProposer+'</div>'+'<div class="card_summary clearfix">'+'<div class="card_image">'+sImg+'</div>'+'<div class="card_name">'+toKanaZenkaku(sCardName)+'</div>'+'<div class="dtl_link">'+sDtlLink+'</div>'+'</div>'+'<div class="act_commands">'+sCommandsHtml+'</div>');}catch(e){$('#card_info_frame').html('<div class="card_info_title">'+'Card Infomation'+'</div>'+'<div class="card_summary clearfix">'+'<div class="card_image"></div>'+'<div class="card_name"></div>'+'<div class="dtl_link"></div>'+'</div>'+'<div class="act_commands">'+'</div>');}}function damageReaction(aArgs){gfd=aArgs.field_data;var act=gfd.cards[aArgs.actor_id];var target=gfd.cards[aArgs.target_id];if(target.pos_category !='field'){throw new Error('invalid_target');}if(0 < aArgs.damage &&(target.pos_id=='myMaster' || target.pos_id=='enemyMaster')){gfd.queues.push({actor_id:null,log_message:'ダメージをストーンに還元',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1004,target_id:target.game_card_id,param1:aArgs.damage,}],});}if(target.status[106] && act){if(gfu.getDistance(act.pos_id,target.pos_id)==1 && !act.status[106]){gfd.queues.push({actor_id:null,log_message:'反撃(竜の盾)',resolved_flg:0,priority:gmd.queue_priority['follow_damage'],queue_units:[{queue_type_id:1005,target_id:aArgs.actor_id,param1:1,}],});}}if(0 < aArgs.damage && 0 < target.hp){if(!target.skill_disable_flg){var targetMonsterData=gmd.m_monster[target.monster_id];var iFrontCardId=getGameCardId({pos_category:'field',pos_id:gfu.getFrontPosId(target.pos_id),});var bReactionPushed=false;switch(targetMonsterData.skill.id){case 16:gfd.queues.push({actor_id:target.game_card_id,log_message:'仮死　発動',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1021,target_id:target.game_card_id,param1:1,},{queue_type_id:1029,target_id:target.game_card_id,},],});bReactionPushed=true;break;case 17:var iBackCardId=null;if(target.owner=='my'){iBackCardId=gfu.getRelativePosId(target.pos_id,{x:0,y:1});}else{iBackCardId=gfu.getRelativePosId(target.pos_id,{x:0,y:-1});}if(!iBackCardId){gfd.queues.push({actor_id:target.game_card_id,log_message:'撤退　発動',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1022,target_id:target.game_card_id,param1:1,param2:false,},{queue_type_id:1029,target_id:target.game_card_id,},],});bReactionPushed=true;}break;case 18:if(iFrontCardId){gfd.queues.push({actor_id:target.game_card_id,log_message:'献身　発動',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1007,target_id:iFrontCardId,param1:1,},{queue_type_id:1029,target_id:target.game_card_id,},],});bReactionPushed=true;}break;case 22:if(gfu.attackRangeCheck(act,target)){gfd.queues.push({actor_id:target.game_card_id,log_message:'反撃　発動',resolved_flg:0,priority:gmd.queue_priority['react_damage'],queue_units:[{queue_type_id:1001,target_id:act.game_card_id,},{queue_type_id:1029,target_id:target.game_card_id,},],});bReactionPushed=true;}break;case 25:if(iFrontCardId){gfd.queues.push({actor_id:target.game_card_id,log_message:'やつあたり　発動',resolved_flg:0,priority:gmd.queue_priority['react_damage'],queue_units:[{queue_type_id:1005,target_id:iFrontCardId,param1:2,},{queue_type_id:1029,target_id:target.game_card_id,},],});bReactionPushed=true;}break;}if(bReactionPushed){gfd.queues.push({actor_id:target.game_card_id,log_message:'',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1028,target_id:target.game_card_id,},],});}}}if(target.hp <=0){if(!target.skill_disable_flg){var targetMonsterData=gmd.m_monster[target.monster_id];var bReactionPushed=false;switch(targetMonsterData.skill.id){case 6:case 14:var iNextMonsterId=gfu.getModifyMonsterId(target.monster_id);gfd.queues.push({actor_id:act.game_card_id,log_message:'',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1021,target_id:target.game_card_id,param1:iNextMonsterId,param2:true,},],});break;default:gfd.queues.push({actor_id:act.game_card_id,log_message:'',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1008,target_id:target.game_card_id,},],});break;}}if(aArgs.priority==gmd.queue_priority.command){if(act.owner==target.owner){gfd.queues.push({actor_id:act.game_card_id,log_message:'',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1023,target_id:act.game_card_id,param1:1,},],});}else{var targetMonsterData=gmd.m_monster[target.monster_id];gfd.queues.push({actor_id:act.game_card_id,log_message:'',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1017,target_id:act.game_card_id,param1:targetMonsterData.lv,},],});}}}var sDom='#'+target.pos_id;gfd.animation_info.animations.push({target_dom:sDom,css_param:{'background-color':'#f00',},animation_param:{'background-color':g_base_color.background,},});if(aArgs.attack_flg){if(typeof act.monster_id !='undefined' && !act.skill_disable_flg){var actorMon=gmd.m_monster[act.monster_id];switch(actorMon.skill.id){case 1:case 2:case 3:var dam=2;if(actorMon.skill.id==2){dam=3;}else if(actorMon.skill.id==3){dam=6;}gfd.queues.push({actor_id:null,log_message:'自爆による反動ダメージ',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1006,target_id:act.game_card_id,param1:dam,},]});break;}}}return true;}function healReaction(aArgs){gfd=aArgs.field_data;var mon=gfd.cards[aArgs.target_id];var aMonsterData=gmd.m_monster[mon.monster_id];var bReactionPushed=false;if(!mon.skill_disable_flg){switch(aMonsterData.skill.id){case 9:gfd.queues.push({actor_id:aArgs.target_id,log_message:'ヒールアップ　発動',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1026,param1:101,target_id:aArgs.target_id,},{queue_type_id:1028,target_id:aArgs.target_id,}],});bReactionPushed=true;break;}}if(bReactionPushed){gfd.queues.push({actor_id:aArgs.target_id,log_message:'',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1028,target_id:aArgs.target_id,},],});}}function wakeupReaction(aArgs){gfd=aArgs.field_data;var act=gfd.cards[aArgs.actor_id];var target=gfd.cards[aArgs.target_id];var aMonsterData=gmd.m_monster[target.monster_id];var bReactionPushed=false;if(typeof target.skill_disable_flg=='undefined' || !target.skill_disable_flg){switch(aMonsterData.skill.id){case 26:if(Math.random()< 0.5){sLogMessage='きまぐれによりパワーアップ';iStatusType=101;}else{sLogMessage='きまぐれによりパワーダウン';iStatusType=104;}gfd.queues.push({actor_id:aArgs.target_id,log_message:sLogMessage,resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1026,param1:iStatusType,target_id:aArgs.target_id,},{queue_type_id:1029,target_id:aArgs.target_id,}],});bReactionPushed=true;break;case 28:gfd.queues.push({actor_id:aArgs.target_id,log_message:'ホロウによりストーン呪い',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1026,param1:123,target_id:aArgs.target_id,},{queue_type_id:1029,target_id:aArgs.target_id,}],});bReactionPushed=true;break;case 29:if(typeof aArgs.system_flg=='undefined'){throw new Error('argument_error');}if(!aArgs.system_flg){var mon=gfd.cards[aArgs.target_id];var posId='enemyMaster';if(mon.owner=='my'){posId='myMaster';}var mst=getGameCardId({pos_category:'field',pos_id:posId,});gfd.queues.push({actor_id:aArgs.target_id,log_message:'ウェイク還元によりストーン２個を還元',resolved_flg:0,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1004,param1:2,target_id:aArgs.target_id,},{queue_type_id:1029,target_id:aArgs.target_id,}],});bReactionPushed=true;}break;}if(bReactionPushed){gfd.queues.push({actor_id:aArgs.target_id,log_message:'',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1028,target_id:aArgs.target_id,},],});}}}function actedReaction(aArgs){var targetMon=gfd.cards[aArgs.target_id];if(targetMon.status[100]){gfd.queues.push({actor_id:aArgs.target_id,log_message:'気合溜め解除',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:100,target_id:aArgs.target_id,}],});}if(targetMon.status[122]){if(1 < targetMon.hp){gfd.queues.push({actor_id:aArgs.target_id,log_message:'ダメージ呪い発動',resolved_flg:0,priority:'follow_damage',queue_units:[{queue_type_id:1006,param1:-1,param2:'damage_noroi',target_id:aArgs.target_id,}],});}}}function isDuplicateFieldPos(aArgs){gfd=aArgs.field_data;var aPosId={};try{$.each(gfd.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(typeof aPosId[val.pos_id] !='undefined'){throw new Error('duplicate_field_pos');}aPosId[val.pos_id]=val.pos_id;});}catch(e){if(e=='duplicate_field_pos'){return true;}else{throw e;}}return false;}function getGameCardId(aArgs){var iRetGameCardId=null;var aFirstInfo=null;var aLastInfo=null;$.each(gfd.cards,function(iGameCardId,val){if(val.pos_category !=aArgs.pos_category){return true;}if(aArgs.owner){if(aArgs.owner !=val.owner){return true;}}switch(aArgs.pos_category){case 'field':if(val.pos_id==aArgs.pos_id){if(val.next_game_card_id){iRetGameCardId=val.next_game_card_id;}else{iRetGameCardId=iGameCardId;}return false;}break;case 'deck':case 'hand':case 'used':if(aFirstInfo==null || aLastInfo==null){aFirstInfo={sort_no:val.sort_no,game_card_id:iGameCardId,};aLastInfo={sort_no:val.sort_no,game_card_id:iGameCardId,};}else{if(val.sort_no < aFirstInfo.sort_no){aFirstInfo={sort_no:val.sort_no,game_card_id:iGameCardId,};}if(val.sort_no > aLastInfo.sort_no){aLastInfo={sort_no:val.sort_no,game_card_id:iGameCardId,};}}break;default:break;}});if(aArgs.sort_type=='first'){iRetGameCardId=aFirstInfo.game_card_id;}else if(aArgs.sort_type=='last'){iRetGameCardId=aLastInfo.game_card_id;}if(isNaN(iRetGameCardId)){return null;}return iRetGameCardId;}})();arts_queue=(function(){return{'getArtsQueue':getArtsQueue,};function getArtsQueue(aArgs){var aQueue=null;try{delete aArgs.field_data.tokugi_fuuji_flg;var mon=aArgs.field_data.cards[aArgs.actor_id];var aArtInfo=gmd.m_arts[aArgs.art_id];var bSealed=(function(){try{if(mon.status[110].param1==aArgs.art_id){gfu.myAlertInField({message:'特技を封じられています！',});return true;}}catch(e){}return false;})();if(bSealed){return null;}aQueue={actor_id:aArgs.actor_id,resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:_getQueueUnitsFromScriptId(aArgs),};if(Number(aArtInfo.stone)!=0){aQueue.queue_units.unshift({queue_type_id:1004,target_id:aArgs.actor_id,param1:-1 * Number(aArtInfo.stone),cost_flg:true,});}aQueue.queue_units.unshift({queue_type_id:1024,target_id:aArgs.actor_id,cost_flg:true,});aQueue.queue_units.unshift({queue_type_id:1002,target_id:aArgs.actor_id,cost_flg:true,});}catch(e){if(e=='tokugi_fuuji'){aArgs.field_data.tokugi_fuuji_flg=true;}return null;}return aQueue;}function _getQueueUnitsFromScriptId(aArgs){var aArtInfo=gmd.m_arts[aArgs.art_id];switch(Number(aArtInfo.script_id)){case 1000:return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,},];break;case 1001:var aActor=aArgs.field_data.cards[aArgs.actor_id];var aTarget=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var p1=gfu.getXYFromPosId(aActor.pos_id);var p2=gfu.getXYFromPosId(aTarget.pos_id);var df={x:p2.x - p1.x,y:p2.y - p1.y};for(var i=2;i <=4;i++){if(df.x % i==0 && df.y % i==0){df.x /=i;df.y /=i;}}var aRet=[];var df0={x:df.x,y:df.y};for(i=1;i <=3;i++){var iDist=Math.max(Math.abs(df.x),Math.abs(df.y));var pow=aArtInfo.power+1 - iDist;var sPosId=gfu.getRelativePosId(aActor.pos_id,df);if(sPosId !=''){$.each(aArgs.field_data.cards,function(j,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});});}df.x+=df0.x;df.y+=df0.y;}if(aRet.length > 0){return aRet;}break;case 1002:var sActorPos=aArgs.field_data.cards[aArgs.actor_id].pos_id;var sTargetPos=aArgs.field_data.cards[aArgs.targets[0].game_card_id].pos_id;var iDist=gfu.getDistance(sActorPos,sTargetPos);return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power+1 - iDist,},];break;case 1003:return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,},{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:101,},];break;case 1004:var aRet=[];var p=gfu.getXYFromPosId(aArgs.field_data.cards[aArgs.targets[0].game_card_id].pos_id);$.each(aArgs.field_data.cards,function(j,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}for(var i=0;i < 4;i++){var sPosId=gfu.getPosIdFromXY({x:p.x,y:i});if(val.pos_id==sPosId){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});}}});if(aRet.length > 0){return aRet;}break;case 1005:return [{queue_type_id:1020,target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,},];break;case 1006:return [{queue_type_id:1017,target_id:aArgs.targets[0].game_card_id,param1:1,param2:true,},];break;case 1007:var aRet=[{queue_type_id:1002,target_id:aArgs.targets[0].game_card_id,param2:true,},];if(Math.random()* 2 < 1){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:targetId,param1:aArtInfo.power,});}return aRet;break;case 1008:var aRet=[{queue_type_id:1017,target_id:aArgs.targets[0].game_card_id,param1:1,param2:true,},];var aMonsterInfo=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var aMonsterData=gmd.m_monster[aMonsterInfo.monster_id];if(aMonsterData.next_monster_id){return aRet;}var bSuper=false;$.each(aArgs.field_data.cards,function(i,val){bSuper=isValidSuper({aBefore:aMonsterInfo,aAfter:val,});if(bSuper){return false;}});if(bSuper){return aRet;}else{return [{queue_type_id:1008,target_id:aArgs.targets[0].game_card_id,},];}break;case 1009:return [{queue_type_id:1008,target_id:aArgs.targets[0].game_card_id,},];break;case 1010:var aRet=[];$.each(gmd.m_status,function(i,val){if(val.status_type=='!'){return true;}aRet.push({queue_type_id:1027,target_id:aArgs.targets[0].game_card_id,});});return aRet;break;case 1011:return [{queue_type_id:1007,target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,},];break;case 1012:var dam=parseInt(Math.random()* 3)+2;return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:dam,},{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.actor_id,param1:dam,},];break;case 1013:var aMonsterInfo=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var iMaxHP=gfu.getMaxHP(aMonsterInfo);var dam=iMaxHP - aMonsterInfo.hp;return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:dam,},{queue_type_id:1008,target_id:aArgs.actor_id,},];break;case 1014:return [{queue_type_id:1002,target_id:aArgs.actor_id,},{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:117,param2:aArgs.actor_id,cost_flg:true,},{queue_type_id:1026,target_id:aArgs.actor_id,param1:118,param2:aArgs.targets[0].game_card_id,cost_flg:true,},];break;case 1015:var aMonsterInfo=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var iMaxHP=gfu.getMaxHP(aMonsterInfo);var aRet=[{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,}];if(iMaxHP <=aMonsterInfo.hp){aRet.push({queue_type_id:1008,target_id:aArgs.actor_id,});}else{aRet.push({queue_type_id:1007,target_id:aArgs.actor_id,param1:aArtInfo.power,});}return aRet;break;case 1016:return [{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:129,},];break;case 1017:var aActor=aArgs.field_data.cards[aArgs.actor_id];var aTarget=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var p1=gfu.getXYFromPosId(aActor.pos_id);var p2=gfu.getXYFromPosId(aTarget.pos_id);var sPosMoveTo=gfu.getRelativePosId(aActor.pos_id,{x:0,y:-1});var aRet=[{queue_type_id:1022,target_id:aArgs.actor_id,param1:sPosMoveTo,cost_flg:true,}];$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.pos_id==sPosMoveTo){aRet.push({queue_type_id:1022,target_id:val.game_card_id,param1:aActor.pos_id,cost_flg:true,});}else{if(val.standby_flg){return true;}for(var j=-1;j <=1;j++){var sPosId=gfu.getPosIdFromXY({x:p1.x+j,y:p1.y - 2,});if(val.pos_id==sPosId){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});break;}}}});return aRet;break;case 1018:var aRet=[];var sPosId=(function(){var a=[ 'enemyBack1','enemyBack2','enemyFront1','enemyFront2','enemyMaster',];return a[parseInt(Math.random()* 5)];})();$.each(aArgs.field_data,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}if(val.pos_id==sPosId){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});}else if(gfu.getDistance(sPosId,val.pos_id)==1){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power - 1,});}});if(aRet.length){return aRet;}break;case 1019:return [{queue_type_id:1007,target_id:aArgs.actor_id,param1:1,},{queue_type_id:1026,target_id:aArgs.actor_id,param1:129,},{queue_type_id:1008,target_id:aArgs.targets[0].game_card_id,cost_flg:true,},];break;case 1020:var aMonsterInfo=gmd.m_monster[aArgs.field_data.cards[aArgs.targets[0].game_card_id].monster_id];return [{queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aMonsterInfo.lv,},];break;case 1021:var aRet=[];if(aArgs.targets[0].game_card_id && aArgs.targets[1].pos_id){aRet.push({queue_type_id:1022,target_id:aArgs.targets[0].game_card_id,param1:aArgs.targets[1].pos_id,});}if(aArgs.targets[1].game_card_id && aArgs.targets[0].pos_id){aRet.push({queue_type_id:1022,target_id:aArgs.targets[1].game_card_id,param1:aArgs.targets[0].pos_id,});}return aRet;break;case 1022:var aRet=[{queue_type_id:1010,target_id:aArgs.targets[0].game_card_id,},];if(aArtInfo.damage_type_flg !='O'){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,});}return aRet;break;case 1023:var aMonsterInfo=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var iStone=2;if(aMonsterInfo.owner=='my'){iStone=Math.min(aArgs.field_data.my_stone,2);}else if(aMonsterInfo.owner=='enemy'){iStone=Math.min(aArgs.field_data.enemy_stone,2);}else{throw new Error('invalid_target');}return [{queue_type_id:1004,target_id:aArgs.targets[0].game_card_id,param1:-1 * iStone,},{queue_type_id:1004,target_id:aArgs.actor_id,param1:iStone,},];break;case 1024:var iSt=101;if(2 <=gmd.m_monster[aArgs.field_data.cards[aArgs.actor_id]].lv){iSt=130;}return [{queue_type_id:1026,target_id:aArgs.actor_id,param1:iSt,},];break;case 1026:var mon=aArgs.field_data.cards[aArgs.actor_id];var aMonsterData=gmd.m_monster[mon.monster_id];var p0=gfu.getXYFromPosId(mon.pos_id);var lrCnt=0;var pow=0;var aRet=[];$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}var p=gfu.getXYFromPosId(val.pos_id);if(p.y==p0.y && p.x !=1){if(p.x==0 && val.card_id !=108){throw new Error('レオンいないのでダメ');}if(p.x==2 && val.card_id !=107){throw new Error('ラオンいないのでダメ');}lrCnt++;if(val.game_card_id !=mon.game_card_id){aRet.push({queue_type_id:1024,target_id:val.game_card_id,cost_flg:true,});}pow+=gmd.m_monster[val.monster_id].attack.power;$.each(val.status,function(sid,stval){switch(sid){case 101:case 102:pow++;break;case 103:pow -=gmd.m_monster[val.monster_id].attack.power;pow+=2;break;case 104:pow--;break;case 105:pow+=2;return true;default:return true;}aRet.push({queue_type_id:1027,target_id:val.game_card_id,param1:sid,});});}});if(lrCnt < 2){throw new Error('invalid_actor');}aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aArgs.targets[0].game_card_id,param1:pow,});return aRet;break;case 1027:return [{queue_type_id:1011,target_id:aArgs.targets[0].game_card_id,param1:'draw',param2:1,},];break;case 1028:return [{queue_type_id:1004,target_id:aArgs.targets[0].game_card_id,param1:-1,cost_flg:true,},{queue_type_id:1017,target_id:aArgs.actor_id,param1:1,param2:true,},{queue_type_id:1019,target_id:aArgs.actor_id,}];break;case 1029:return [{queue_type_id:1008,target_id:aArgs.actor_id,}];break;case 1030:return [{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:128,}];break;case 1031:if(aArgs.param2){return [{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:110,param2:aArgs.param2,}];}else{throw 'tokugi_fuuji';}break;case 1032:var aActor=aArgs.field_data.cards[aArgs.actor_id];var aRet=[{queue_type_id:1008,target_id:aArgs.actor_id,},{queue_type_id:1013,target_id:aArgs.targets[0].game_card_id,param1:aActor.pos_id,},{queue_type_id:1010,target_id:aArgs.targets[0].game_card_id,},];if(gmd.m_monster[aActor.monster_id].lv==2){aRet.push({queue_type_id:1017,target_id:aArgs.targets[0].game_card_id,param1:1,param2:true,});aRet.push({queue_type_id:1019,target_id:aArgs.targets[0].game_card_id,});}return aRet;break;case 1033:var aTarget=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var aRet=[];try{$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.owner !=aTarget.owner){return true;}if(val.status){if(val.status[114]){throw 'kagenui';}}var sPosId='';switch(val.pos_id){case 'myFront1':case 'enemyBack2':sPosId=gfu.getRelativePosId(val.pos_id,{x:2,y:0});break;case 'myFront2':case 'enemyBack1':sPosId=gfu.getRelativePosId(val.pos_id,{x:0,y:1});break;case 'myBack1':case 'enemyFront2':sPosId=gfu.getRelativePosId(val.pos_id,{x:0,y:-1});break;case 'myBack2':case 'enemyFront1':sPosId=gfu.getRelativePosId(val.pos_id,{x:-2,y:0});break;}if(sPosId){aRet.push({queue_type_id:1022,target_id:val.game_card_id,param1:sPosId,});}});}catch(e){if(e !='kagenui'){throw e;}aRet=[];}aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:aTarget.game_card_id,param1:aArtInfo.power,});return aRet;break;case 1034:return [{queue_type_id:1020,target_id:aArgs.targets[0].game_card_id,param1:1,cost_flg:true,},{queue_type_id:1017,target_id:aArgs.targets[1].game_card_id,param1:1,},];break;case 1035:return [{queue_type_id:1004,target_id:aArgs.targets[0].game_card_id,param1:aArtInfo.power,},];break;case 1036:return [{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:106,},];break;case 1037:return [{queue_type_id:1026,target_id:aArgs.targets[0].game_card_id,param1:102,},];break;case 1038:var aRet=[];var mon=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var p1=gfu.getXYFromPosId(mon.pos_id);$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}var p2=gfu.getXYFromPosId(val.pos_id);if(p2.y==p1.y){aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});}});return aRet;break;case 1039:var aRet=[];var mon=aArgs.field_data.cards[aArgs.targets[0].game_card_id];$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.next_game_card_id){return true;}if(val.standby_flg){return true;}aRet.push({queue_type_id:(aArtInfo.damage_type_flg=='D' ? 1006:1005),target_id:val.game_card_id,param1:aArtInfo.power,});});return aRet;break;case 1040:var aRet=[];var mon=aArgs.field_data.cards[aArgs.targets[0].game_card_id];var aMonsterData=gmd.m_monster[mon.game_card_id];$.each(gmd.m_status,function(iStatusId,val){aRet.push({queue_type_id:1027,targets:aArgs.targets[0].game_card_id,param1:iStatusId,});});for(var i=1;i < aMonsterData.lv;i++){aRet.push({queue_type_id:1020,target_id:aArgs.targets[0].game_card_id,param1:true,});}aRet.push({queue_type_id:1030,target_id:aArgs.targets[0].game_card_id,});return aRet;break;case 1041:var aRet=[];var sOwner='my';if(parseInt(Math.random()* 2)){sOwner='enemy';}$.each(aArgs.field_data.cards,function(i,val){if(val.pos_category !='field'){return true;}if(val.standby_flg){return true;}if(val.owner !=sOwner){return true;}aRet.push({queue_type_id:(sOwner=='my')? 1007:1006,target_id:val.game_card_id,param1:aArtInfo.power,});});return aRet;break;default:throw new Error('unknown script_id posted.');}throw new Error('_getQueueUnitsFromScriptId Failure.');}})();new function(){var gfd={turn:null,my_stone:0,enemy_stone:0,lvup_assist:0,cards:{},queues:[],actor:{game_card_id:null,},animation_info:{bAnimationProcessing:false,animations:[],},};var g_backup_field_data=null;var g_base_color={background:'#fff',};$(function(){initSetting();initField();setTimeout(function(){startingProc();},333);$(document).on('click','#game_field td.monster_space',function(){var oDom=$(this);var sGameState=checkGameState();switch(sGameState){case 'normal':case 'lvup_standby':var sActorAutoChange=$('[name=actor_auto_change]:checked').val();if(!sActorAutoChange){sActorAutoChange='hand';}try{var sActorPos=gfd.cards[gfd.actor.game_card_id].pos_category;}catch(e){sActorPos='unknown';}var _updateActorInfo=function(){var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:oDom.attr('id'),});gfd.actor={game_card_id:iGameCardId};$('.actor').removeClass('actor');oDom.addClass('actor');gfr.updateActorDom({field_data:gfd,game_state:sGameState,});};if(!gfd.actor.act_type){_updateActorInfo();}else{var actor=gfd.actor;var bRange=addTarget({oDom:oDom,});if(bRange){}else if(sActorAutoChange==sActorPos || sActorAutoChange=='all'){_updateActorInfo();}}break;}});$(document).on('click','#hand_card div.hand_card',function(){var oDom=$(this);switch(checkGameState()){case 'normal':var sActorAutoChange=$('[name=actor_auto_change]:checked').val();if(!sActorAutoChange){sActorAutoChange='hand';}try{var sActorPos=gfd.cards[gfd.actor.game_card_id].pos_category;}catch(e){sActorPos='unknown';}var _updateActorInfo=function(){gfd.actor={game_card_id:oDom.attr('game_card_id')};$('.actor').removeClass('actor');oDom.addClass('actor');gfr.updateActorDom({field_data:gfd,});};if(!gfd.actor.act_type){_updateActorInfo();}else{var bRange=addTarget({oDom:oDom,});if(bRange){}else if(sActorAutoChange==sActorPos || sActorAutoChange=='all'){_updateActorInfo();}}break;case 'lvup_standby':try{if(gfd.actor.act_type !='lvup'){break;}}catch(e){break;}var ret=gfu.isValidSuper({aBefore:gfd.cards[gfd.actor.game_card_id],aAfter:gfd.cards[oDom.attr('game_card_id')],check_lvup_standby:true,lvup_assist:gfd.lvup_assist,});if(ret){var aQueue={actor_id:null,resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1019,target_id:gfd.actor.game_card_id,param1:oDom.attr('game_card_id'),},],};if(!gfd.lvup_magic_flg){aQueue.queue_units.unshift({queue_type_id:1004,target_id:gfd.actor.game_card_id,param1:-1,cost_flg:true,});}gfd.queues.push(aQueue);gfd.actor={game_card_id:null};execQueue({resolve_all:true});}break;}});$(document).on('click','.command_row',function(){var oDom=$(this);var aCard=gfd.cards[gfd.actor.game_card_id];switch(checkGameState()){case 'normal':case 'lvup_standby':if(aCard.owner=='enemy' && oDom.attr('act_type')!='lvup'){return;}switch(aCard.pos_category){case 'field':if(aCard.standby_flg){return;}gfd.actor.act_type=oDom.attr('act_type');gfd.actor.art_id=oDom.attr('art_id');var prm1=oDom.attr('param1');if(typeof prm1 !=='undefined'){gfd.actor.param1=prm1;}if(gfd.actor.act_type=='lvup'){var aCardData=gmd.m_monster[aCard.monster_id];if(aCardData.next_monster_id){addTarget({oDom:oDom,});}}break;case 'hand':gfd.actor.act_type=oDom.attr('act_type');var prm1=oDom.attr('param1');if(typeof prm1 !=='undefined'){gfd.actor.param1=prm1;}break;}$('.command_row').removeClass('selected_act');oDom.addClass('selected_act');break;case 'tokugi_fuuji':var aQueue=arts_queue.getArtsQueue({field_data:gfd,art_id:gfd.actor.art_id,actor_id:gfd.actor.game_card_id,targets:gfd.actor.aTargets,param2:oDom.attr('art_id'),});if(aQueue){gfd.queues.push(aQueue);execQueue({resolve_all:true});}break;}});$(document).on('click','#buttons_frame div.cancel_button',function(){switch(checkGameState()){case 'tokugi_fuuji':delete gfd.tokugi_fuuji_flg;case 'normal':gfd.actor={game_card_id:null};$('.actor').removeClass('actor');gfr.updateActorDom({field_data:gfd,});break;case 'lvup_standby':if(gfd.actor.game_card_id){gfd.actor={game_card_id:null};$('.actor').removeClass('actor');}else if(confirm('レベルアップしなくても良いですか？')){(function(){gfd.queues.push({actor_id:null,log_message:'',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1018,}],});$('.lvup_ok').removeClass('lvup_ok');$('.lvup_checking').removeClass('lvup_checking');execQueue({resolve_all:true});})();}gfr.updateActorDom({field_data:gfd,});break;}});$(document).on('click','#buttons_frame div.turn_end_button',function(){if(confirm("ターンエンドしてもよろしいですか？")){turnEndProc();}});});function initField(){gfr.initMasterData({field_data:gfd,master_data:gmd,base_color:g_base_color,});var iGameFieldScrollPos=$('#game_field').offset().top;$('html,body').animate({scrollTop:iGameFieldScrollPos},1);gfd.turn=Number($('div[turn_num]').attr('turn_num'));gfd.my_stone=Number($('#myPlayersInfo div.stone span').text());gfd.enemy_stone=Number($('#enemyPlayersInfo div.stone span').text());gfd.cards=getCardsJson();$.each(gfd.cards,function(iGameCardId,val){if(val.next_game_card_id){gfd.cards[val.next_game_card_id].before_game_card_id=iGameCardId;}if(typeof val.status !='undefined'){if(val.status.length <=0){val.status={};}}});return;$('#game_field td.monster_space').each(function(){var iGameCardId=Number($(this).attr('game_card_id'));if(isNaN(iGameCardId)){return true;}var posId=$(this).attr('id');var p=gfu.getXYFromPosId(posId);var sOwner='my';if(p.y <=1){sOwner='enemy';}var standbyFlg=0;if($(this).find('div[standby_flg]').size()> 0){standbyFlg=1;}var aMonsterData={game_card_id:iGameCardId,card_id:Number($(this).attr('card_id')),monster_id:Number($(this).attr('monster_id')),owner:sOwner,pos_category:'field',sort_no:0,pos_id:posId,hp:Number($(this).find('span.hp').text()),standby_flg:standbyFlg,skill_disable_flg:0,act_count:0,lvup_standby:0,status:{}};$(this).find('div.status_hidden_param').find('div.status_row').each(function(){var sid=Number($(this).attr('status_id'));aMonsterData.status[sid]={status_id:Number($(this).attr('status_id')),turn_count:Number($(this).attr('turn_count')),param1:$(this).attr('param1'),param2:$(this).attr('param2'),};});gfd.cards[aMonsterData.game_card_id]=aMonsterData;});var iSortNo=1;$('.hidden_cards_info div.hand_card').each(function(){var iGameCardId=$(this).attr('game_card_id');var sOwner='my';if(gfd.turn !=$(this).attr('owner')){sOwner='enemy';}gfd.cards[$(this).attr('game_card_id')]={game_card_id:Number($(this).attr('game_card_id')),card_id:Number($(this).attr('card_id')),owner:sOwner,pos_category:'hand',sort_no:iSortNo,};iSortNo++;});var iSortNo=1;$('.hidden_cards_info div.deck_card').each(function(){var iGameCardId=$(this).attr('game_card_id');var sOwner='my';if(gfd.turn !=$(this).attr('owner')){sOwner='enemy';}gfd.cards[$(this).attr('game_card_id')]={game_card_id:Number($(this).attr('game_card_id')),card_id:Number($(this).attr('card_id')),owner:sOwner,pos_category:'deck',sort_no:iSortNo,};iSortNo++;});var iSortNo=1;$('.hidden_cards_info div.used_card').each(function(){var iGameCardId=$(this).attr('game_card_id');var sOwner='my';if(gfd.turn !=$(this).attr('owner')){sOwner='enemy';}gfd.cards[$(this).attr('game_card_id')]={game_card_id:Number($(this).attr('game_card_id')),card_id:Number($(this).attr('card_id')),owner:sOwner,pos_category:'used',sort_no:iSortNo,};iSortNo++;});}function initSetting(){var aRadioSettings=[ 'animation_speed','actor_auto_change','alert_popup',];try{var stor=localStorage.game_settings;if(typeof stor=='undefined'){stor='{}';localStorage.setItem('game_settings',stor);}var param=JSON.parse(stor);$.each(aRadioSettings,function(i,val){$('[name='+val+']').val([param[val]]);});}catch(e){}$(document).on('click','input.toggle_setting',function(){$('div.settings').toggle();$('input.disp_button').toggle();});$.each(aRadioSettings,function(i,val){$(document).on('change','input[name='+val+']',function(){try{var param=JSON.parse(localStorage.game_settings);param[val]=$('input[name='+val+']:checked').val();localStorage.setItem('game_settings',JSON.stringify(param));}catch(e){}});});}function startingProc(){var myMasterId=gfr.getGameCardId({pos_category:'field',pos_id:'myMaster',});gfd.queues.push({actor_id:null,log_message:'ストーン3個を支給',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1004,target_id:myMasterId,param1:3,}],});var targetId=gfr.getGameCardId({pos_category:'deck',owner:'my',sort_type:'first',});gfd.queues.push({actor_id:null,log_message:'カードを1枚ドロー',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1011,target_id:targetId,param1:'draw',param2:1,}],});var keys=[ 'myMaster','myFront1','myFront2','myBack1','myBack2' ];for(var i=0;i < keys.length;i++){var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:keys[i],});var mon=gfd.cards[iGameCardId];if(mon && !isNaN(mon.card_id)&& mon.standby_flg){var aMonsterData=gmd.m_monster[mon.monster_id];gfd.queues.push({actor_id:mon.game_card_id,log_message:gfu.getPosCodeFromPosId(mon.pos_id)+aMonsterData.name+'登場',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1010,target_id:mon.game_card_id,}],});}}keys=[ 'myBack1','myBack2',];for(var i=0;i < keys.length;i++){var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:keys[i],});var frontPos=gfu.getRelativePosId(keys[i],{x:0,y:-1});var iFrontGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:frontPos,});if(iGameCardId && !iFrontGameCardId){var mon=gfd.cards[iGameCardId];gfd.queues.push({actor_id:mon.game_card_id,log_message:gmd.m_monster[mon.monster_id].name+'が前進',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1022,target_id:iGameCardId,param1:frontPos,}],});}}execQueue({resolve_all:true});}function checkGameState(){if(typeof gfd.sort_card_flg !='undefined'){return 'sort_card';}if(typeof gfd.tokugi_fuuji_flg !='undefined'){return 'tokugi_fuuji';}try{$.each(gfd.cards,function(i,val){if(typeof val.status !='undefined'){if(typeof val.status[111] !='undefined'){return true;}if(typeof val.status[127] !='undefined'){return true;}if(typeof val.status[128] !='undefined'){return true;}}if(0 < val.lvup_standby){throw 'lvup_standby';}if(0 < gfd.lvup_assist){throw 'lvup_standby';}});}catch(e){if(e=='lvup_standby'){return 'lvup_standby';}else{throw e;}}return 'normal';}function checkTargetPosValid(aArgs){try{if(Number(aArgs.target_order)){switch(aArgs.range_type_id){case 16:case 27:if(target_order==1){if(gfd.cards[aArgs.target_id].owner !='enemy'){return false;}}else if(target_order==2){if(gfd.cards[aArgs.target_id].owner !='my'){return false;}}aArgs.range_type_id=7;break;case 29:aArgs.range_type_id=6;break;}}if(aArgs.range_type_id==12){var p1=gfu.getXYFromPosId(aArgs.target_pos_id);if(!p1){var mon=gfd.cards[aArgs.target_id];p1=gfu.getXYFromPosId(mon.pos_id);}if(p1.x !=1){return true;}}else if(aArgs.range_type_id==30){var tmp=gfu.getXYFromPosId(aArgs.target_pos_id);if(!tmp || tmp.y <=1){return false;}var mon=gfr.getGameCardId({pos_category:'field',pos_id:aArgs.target_pos_id,});if(mon){return false;}else{return true;}}if(!aArgs.actor_id){aArgs.actor_id=gfd.actor.game_card_id;}if(aArgs.target_pos_id){aArgs.target_id=gfr.getGameCardId({pos_category:'field',pos_id:aArgs.target_pos_id,});}var actorMon=gfd.cards[aArgs.actor_id];var targetMon=gfd.cards[aArgs.target_id];switch(aArgs.range_type_id){case 12:case 26:break;case 23:if(!targetMon.standby_flg){return false;}break;default:if(targetMon.standby_flg !=false){return false;}break;}switch(aArgs.range_type_id){case 0:if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)==1){return true;}break;case 1:if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)==2){return true;}break;case 2:if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)==3){return true;}break;case 4:var p1=gfu.getXYFromPosId(aArgs.actor_id);var p2=gfu.getXYFromPosId(aArgs.target_id);if(p1.x==p2.x){for(i=Math.min(p1.y,p2,y)+1;i < Math.max(p1.y,p2.y);i++){var betweenId=gfu.getPosIdFromXY({x:p1.x,y:i});if(betweenId !=''){if(!gfd.cards[betweenId].standby_flg){return false;}}}}case 3:var p1=gfu.getXYFromPosId(aArgs.actor_id);var p2=gfu.getXYFromPosId(aArgs.target_id);var dist=Math.max(Math.abs(p1.x - p2.x),Math.abs(p1.y - p2.y));var p3={x:(p2.x - p1.x)/ dist,y:(p2.y - p1.y)/ dist,};for(var i=1;i < dist;i++){var pTmp={x:p3.x,y:p3.y};pTmp.x *=i;pTmp.y *=i;var betweenId=gfr.getGameCardId({pos_category:'field',pos_id:gfu.getRelativePosId(aArgs.actor_id,pTmp),});if(betweenId){if(gfd.cards[betweenId].standby_flg){return false;}}}if(dist <=2 ||(dist <=3 && aArgs.range_type_id==4)){return true;}break;case 5:case 6:case 10:case 29:return true;break;case 12:case 7:case 11:case 16:case 27:if(gmd.m_card[targetMon.card_id].category=='master'){return false;}return true;break;case 9:if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)==3){return true;}case 8:var p1=gfu.getXYFromPosId(aArgs.actor_id);var p2=gfu.getXYFromPosId(aArgs.target_id);var df={x:Math.abs(p1.x - p2.x),y:Math.abs(p1.y - p2.y)};if(Math.min(df.x,df.y)==1 && Math.max(df.x,df.y)==2){return true;}break;case 13:if(gmd.m_card[targetMon.card_id].category=='master'){return false;}if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)==1){return true;}break;case 14:var dist=gfu.getDistance(actorMon.pos_id,targetMon.pos_id);if(dist==2 || dist==3){return true;}break;case 15:if(targetMon.owner=='my' && targetMon.pos_id !='myMaster'){return true;}break;case 17:if(targetMon.owner !='my' || targetMon.pos_id=='myMaster'){return false;}var nMaxAct=1;var aMonsterData=gmd.m_monster[targetMon.monster_id];if(aMonsterData.skill.id==4){nMaxAct=2;}else if(aMonsterData.skill.id==5){nMaxAct=3;}if(targetMon.act_count < nMaxAct){return true;}break;case 18:var p1=gfu.getXYFromPosId(actorMon.pos_id);var p2=gfu.getXYFromPosId(targetMon.pos_id);if(p1.y !=3){return false;}if(p2.y !=1){return false;}if(Math.abs(p2.x - p1.x)<=1){return true;}break;case 19:case 31:var p2=gfu.getXYFromPosId(targetMon.pos_id);if(aArgs.range_type_id==19){var cd=gmd.m_card[targetMon.card_id];if(cd.category=='master'){return false;}}if(p2.y==1 || p2.y==2){return true;}break;case 20:var p2=gfu.getXYFromPosId(targetMon.pos_id);if(p2.y==0 || p2.y==3){return true;}break;case 22:if(gfu.getDistance(actorMon.pos_id,targetMon.pos_id)!=1){return false;}case 21:var cd=gmd.m_card[targetMon.card_id];if(cd.category=='master'){return true;}break;case 23:var cd=gmd.m_card[targetMon.card_id];if(cd.category !='master'){return true;}break;case 24:var mon=gmd.m_monster[actorMon.monster_id];var p1=gfu.getXYFromPosId(actorMon.pos_id);var p2=gfu.getXYFromPosId(targetMon.pos_id);if(p2.y - p1.y==-1){if(p2.x - p1.x==-1 && mon.skill.id==23){return true;}else if(p2.x - p1.x==1 && mon.skill.id==24){return true;}}break;case 25:if(targetMon.pos_id=='myMaster'){return true;}break;case 26:if(targetMon.pos_category=='hand' && targetMon.owner=='my'){return true;}break;case 28:if(targetMon.card_id==1){return true;}break;case 32:var p1=gfu.getXYFromPosId(actorMon.pos_id);var p2=gfu.getXYFromPosId(targetMon.pos_id);var df={x:p2.x-p1.x,y:p2.y-p1.y};if(df.y==-1){if(df.x==0 || df.x==1){return true;}}break;case 33:var p1=gfu.getXYFromPosId(actorMon.pos_id);var p2=gfu.getXYFromPosId(targetMon.pos_id);var df={x:p2.x-p1.x,y:p2.y-p1.y};if(df.y==-1){if(df.x==0 || df.x==-1){return true;}}break;}}catch(e){}return false;}function addTarget(aArgs){var _addActionFromActorInfo=function(){var actor=gfd.actor;var aQueue=null;switch(actor.act_type){case 'into_field':if(!actor.game_card_id || !actor.param1){throw new Error('actor_info_invalid');}aQueue={actor_id:actor.game_card_id,log_message:'モンスターをセット',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1004,target_id:actor.game_card_id,param1:-1,cost_flg:true,},{queue_type_id:1013,target_id:actor.game_card_id,param1:actor.param1,},],};break;case 'attack':aQueue={actor_id:actor.game_card_id,log_message:'通常攻撃',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1024,target_id:actor.game_card_id,cost_flg:true,},{queue_type_id:1001,target_id:actor.aTargets[0].game_card_id,},],};var mon=gfd.cards[actor.game_card_id];var aCardData=gmd.m_card[mon.card_id];if(aCardData.category=='master'){aQueue.queue_units.unshift({queue_type_id:1004,target_id:actor.game_card_id,param1:-3,cost_flg:true,});}break;case 'arts':aQueue=arts_queue.getArtsQueue({field_data:gfd,art_id:actor.art_id,actor_id:actor.game_card_id,targets:actor.aTargets,});if(gfd.tokugi_fuuji_flg){gfu.myAlertInField({message:'封じる特技を選んで下さい',});gfr.updateActorDom({field_data:gfd,game_state:'tokugi_fuuji',});}break;case 'move':aQueue={actor_id:actor.game_card_id,log_message:'移動',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1024,target_id:actor.game_card_id,cost_flg:true,},{queue_type_id:1022,target_id:actor.game_card_id,param1:actor.param1,},],};var iPurpose=gfr.getGameCardId({pos_category:'field',pos_id:actor.param1,});if(iPurpose){aQueue.queue_units.push({queue_type_id:1024,target_id:iPurpose,cost_flg:true,});aQueue.queue_units.push({queue_type_id:1022,target_id:iPurpose,param1:gfd.cards[actor.game_card_id].pos_id,});}break;case 'escape':aQueue={actor_id:actor.game_card_id,log_message:'逃走',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1008,target_id:actor.game_card_id,},{queue_type_id:1023,target_id:actor.game_card_id,cost_flg:true,},{queue_type_id:1024,target_id:actor.game_card_id,cost_flg:true,}],};break;case 'make_card':aQueue={actor_id:actor.game_card_id,log_message:'メイクカードを使用',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1011,target_id:actor.game_card_id,param1:'draw',param2:1,},{queue_type_id:1023,target_id:actor.game_card_id,cost_flg:true,}],};break;case 'lvup':aQueue={actor_id:actor.game_card_id,log_message:'レベルアップ',resolved_flg:0,priority:gmd.queue_priority['command'],queue_units:[{queue_type_id:1019,target_id:actor.game_card_id,},],};if(!gfd.lvup_magic_flg){aQueue.queue_units.unshift({queue_type_id:1004,target_id:actor.game_card_id,param1:-1,cost_flg:true,});}break;}if(aQueue){gfd.queues.push(aQueue);gfd.actor={game_card_id:null};$('.actor').removeClass('actor');execQueue({resolve_all:true});}};try{var actor=gfd.actor;if(!actor.aTargets){actor.aTargets=[];}var actorMon=gfd.cards[actor.game_card_id];var aTargetInfo={game_card_id:aArgs.oDom.attr('game_card_id'),pos_id:aArgs.oDom.attr('id'),};if(aTargetInfo.pos_id){aTargetInfo.game_card_id=gfr.getGameCardId({pos_category:'field',pos_id:aArgs.oDom.attr('id'),});}switch(actor.act_type){case 'into_field':var bRangeOk=checkTargetPosValid({actor_id:actor.game_card_id,target_id:aTargetInfo.game_card_id,target_pos_id:aTargetInfo.pos_id,range_type_id:30,});if(!bRangeOk){return false;}actor.param1=aTargetInfo.pos_id;_addActionFromActorInfo();return true;break;case 'attack':if(gfu.attackRangeCheck(actorMon,gfd.cards[aTargetInfo.game_card_id])){actor.aTargets.push(aTargetInfo);_addActionFromActorInfo();}break;case 'arts':case 'magic':var bRangeOk=checkTargetPosValid({actor_id:actor.game_card_id,target_id:aTargetInfo.game_card_id,target_pos_id:aTargetInfo.pos_id,range_type_id:gmd.m_arts[actor.art_id].range_type_id,target_order:actor.aTargets.length,});if(!bRangeOk){return false;}$('#'+aTargetInfo.pos_id).addClass('target');actor.aTargets.push(aTargetInfo);_addActionFromActorInfo();break;case 'move':var bRangeOk=checkTargetPosValid({actor_id:actor.game_card_id,target_pos_id:aTargetInfo.pos_id,range_type_id:12,});if(!bRangeOk){return false;}actor.param1=aTargetInfo.pos_id;_addActionFromActorInfo();break;case 'escape':case 'make_card':if(actor.game_card_id==aTargetInfo.game_card_id){_addActionFromActorInfo();}break;case 'lvup':_addActionFromActorInfo();break;}}catch(e){}return false;}function execQueue(aArgs){delete gfd.tokugi_fuuji_flg;gfd.actor={game_card_id:null};var bRecursive=aArgs.resolve_all;var act=gfd.queues;var all_resolved=true;var exec_act=null;for(var i=0;i < act.length;i++){if(act[i].resolved_flg){continue;}all_resolved=false;if(exec_act==null || exec_act.priority < act[i].priority){exec_act=act[i];}}if(all_resolved){(function(){$.each(gfd.cards,function(iGameCardId,val){if(val.pos_category !='field'){removeMonsterInfoOnField(iGameCardId);}});})();var sMessage='';switch(checkGameState()){case 'lvup_standby':sMessage='レベルアップさせるモンスターを選んで下さい';break;}gfu.myAlertInField({message:sMessage,});return;}exec_act.failure_flg=false;exec_act.resolved_flg=true;var bMoveQueueResolved=false;var bEffectQueueResolved=false;var backupFieldWhileSingleActionProcessing={};$.extend(true,backupFieldWhileSingleActionProcessing,gfd);if(exec_act.priority==gmd.queue_priority['command']){g_backup_field_data={};$.extend(true,g_backup_field_data,gfd);}try{if(!exec_act.actor_anime_disable){if(typeof gfd.cards[exec_act.actor_id] !='undefined'){if(gfd.cards[exec_act.actor_id].pos_category=='field'){var sDom='#'+gfd.cards[exec_act.actor_id].pos_id;for(var i=0;i < 2;i++){gfd.animation_info.animations.push({target_dom:sDom,animation_time_rate:0.5,animation_param:{'background-color':'#0e0',},});gfd.animation_info.animations.push({target_dom:sDom,animation_time_rate:0.5,animation_param:{'background-color':g_base_color.background,},});}}}}for(var iterator_of_queue_now_proc=0;iterator_of_queue_now_proc < exec_act.queue_units.length;iterator_of_queue_now_proc++){var q=exec_act.queue_units[iterator_of_queue_now_proc];if(typeof q !='object'){continue;}q.failure_flg=true;var backupFieldWhileSingleQueueProcessing={};$.extend(true,backupFieldWhileSingleQueueProcessing,gfd);try{switch(q.queue_type_id){case 1000:$.each(gfd.queues,function(i,vQueue){if(vQueue.before_turn_flg){delete vQueue;}});var sHtml='<input type="hidden" name="field_data" value=\''+JSON.stringify(gfd)+'\' />';$('form[name=form_current_field]').append(sHtml);gfr.updateField({field_data:gfd,});var iAnimationTime=parseInt($('[name=animation_speed]:checked').val());setTimeout(function(){document.form_current_field.submit();},(isNaN(iAnimationTime)? 100:iAnimationTime));break;case 1001:var actorMon=gfd.cards[exec_act.actor_id];var aMonsterData=gmd.m_monster[actorMon.monster_id];var pow=aMonsterData.attack.power;if(actorMon.mad_hole_cnt){pow+=actorMon.mad_hole_cnt;}if(actorMon.status[100]){pow++;}pow=calcPow(exec_act.actor_id,q.target_id,pow);if(pow > 0){var targetMon=gfd.cards[q.target_id];targetMon.hp -=pow;}gfr.damageReaction({field_data:gfd,actor_id:exec_act.actor_id,priority:exec_act.priority,target_id:q.target_id,damage:pow,attack_flg:true,});break;case 1002:if(q.param2){break;}var actorMon=gfd.cards[exec_act.actor_id];if(!actorMon.skill_disable_flg){var aMonsterData=gmd.m_monster[actorMon.monster_id];switch(aMonsterData.skill.id){case 7:gfd.queues.push({actor_id:actorMon.game_card_id,log_message:'',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1008,target_id:actorMon.game_card_id,},],});break;case 12:gfd.queues.push({actor_id:actorMon.game_card_id,log_message:'性格「後退」発動',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['reaction'],queue_units:[{queue_type_id:1022,target_id:actorMon.game_card_id,param1:gfu.getRelativePosId(actorMon.pos_id,{x:0,y:1}),},],});break;}}break;case 1003:break;case 1004:var sOwner=gfd.cards[q.target_id].owner;if(sOwner=='my'){gfd.my_stone+=Number(q.param1);if(gfd.my_stone < 0){if(q.cost_flg){throw new Error('minus_stone');}else{gfd.my_stone=0;}}var posId='#myPlayersInfo div.stone';}else if(sOwner=='enemy'){gfd.enemy_stone+=Number(q.param1);if(gfd.enemy_stone < 0){if(q.cost_flg){throw new Error('minus_stone');}else{gfd.enemy_stone=0;}}var posId='#enemyPlayersInfo div.stone';}else{throw new Error('no_target');}gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'hide',},});gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'show',},});break;case 1005:var targetMon=gfd.cards[q.target_id];var pow=calcPow(exec_act.actor_id,q.target_id,q.param1);if(0 < pow){targetMon.hp -=pow;}gfr.damageReaction({field_data:gfd,actor_id:exec_act.actor_id,priority:exec_act.priority,target_id:q.target_id,damage:pow,});var sPosId='#'+targetMon.pos_id;gfd.animation_info.animations.push({target_dom:sPosId,css_param:{'background-color':'#f00',},animation_param:{'background-color':g_base_color.background,},});break;case 1006:var targetMon=gfd.cards[q.target_id];var dam=q.param1;if(q.param2=='damage_noroi'){dam=targetMon.hp - 1;if(dam <=0){throw new Error('argument_error');}}var dam=calcDam(exec_act.actor_id,q.target_id,dam);if(0 < dam){targetMon.hp -=dam;}gfr.damageReaction({field_data:gfd,actor_id:exec_act.actor_id,priority:exec_act.priority,target_id:q.target_id,damage:dam,});var sPosId='#'+targetMon.pos_id;gfd.animation_info.animations.push({target_dom:sPosId,css_param:{'background-color':'#f00',},animation_param:{'background-color':g_base_color.background,},});break;case 1007:if(0 < q.param1){var targetMon=gfd.cards[q.target_id];var iMaxHP=gfu.getMaxHP(targetMon);targetMon.hp+=q.param1;if(iMaxHP < targetMon.hp){targetMon.hp=iMaxHP;}gfr.healReaction({field_data:gfd,actor_id:exec_act.actor_id,target_id:q.target_id,heal:q.param1,});}break;case 1008:var targetMon=gfd.cards[q.target_id];$.each(gfd.cards,function(ii,vv){if(vv.pos_category !='field'){return true;}else if(!vv.pos_id){return true;}else if(vv.pos_id !=targetMon.pos_id){return true;}var iSortNo=1;$.each(gfd.cards,function(i,val){if(val.pos_category=='used'){if(iSortNo <=val.sort_no){iSortNo=val.sort_no+1;}}});vv.pos_category='used';vv.sort_no=iSortNo;});gfd.queues.push({actor_id:targetMon.game_card_id,log_message:'LV分のストーンを還元',resolved_flg:0,actor_anime_disable:true,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1004,target_id:targetMon.game_card_id,param1:gmd.m_monster[targetMon.monster_id].lv,}],});gfd.animation_info.animations.push({target_dom:'#'+targetMon.pos_id+' .pict img',animation_param:{width:0,height:0,margin:'25px',},});break;case 1011:var mon=gfd.cards[q.target_id];if(q.param1=='draw' && q.param2 &&(mon.pos_id=='myMaster' || mon.pos_id=='enemyMaster')){(function(){for(var i=0;i < q.param2;i++){var iGameCardId=gfr.getGameCardId({pos_category:'deck',owner:mon.owner,sort_type:'first',});gfd.cards[iGameCardId].pos_category='hand';}})();break;}case 1009:case 1015:gfd.cards[q.target_id].pos_category='hand';(function(){if(gfd.cards[q.target_id].owner=='my'){var posId='#myPlayersInfo div.hand';}else{var posId='#enemyPlayersInfo div.hand';}gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'hide',},});gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'show',},});gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'hide',},});gfd.animation_info.animations.push({target_dom:posId,animation_param:{'opacity':'show',},});})();break;case 1010:var targetMon=gfd.cards[q.target_id];targetMon=gfu.loadMonsterInfo({target_monster:targetMon,standby_flg:false,reset_hp:true,reset_act_count:true,});gfr.wakeupReaction({field_data:gfd,actor_id:exec_act.actor_id,target_id:q.target_id,system_flg:(exec_act.priority==gmd.queue_priority['system']),});break;case 1012:break;case 1013:var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:q.param1,});if(iGameCardId){throw new Error('no_target');}var targetMon=gfd.cards[q.target_id];var dest=gfr.getGameCardId({pos_category:'field',pos_id:q.param1,});if(dest){throw new Error('argument_error');}targetMon=gfu.loadMonsterInfo({target_monster:targetMon,pos_id:q.param1,standby_flg:true,reset_hp:true,});break;case 1014:var iSortNo=1;$.each(gfd.cards,function(i,val){if(val.pos_category=='used'){if(iSortNo <=val.sort_no){iSortNo=val.sort_no+1;}}});var target=gfd.cards[q.target_id];target.pos_category='used';target.sort_no=iSortNo;break;case 1016:mon=gfu.loadMonsterInfo({target_monster:mon,check_blank:true,reset_hp:true,});break;case 1017:gfd.cards[q.target_id].lvup_standby+=parseInt(q.param1);if(q.param2){gfd.lvup_magic_flg=true;}else{try{delete gfd.lvup_magic_flg;}catch(e){}}break;case 1018:gfd.lvup_assist=0;$.each(gfd.cards,function(i,vval){if(vval.lvup_standby){vval.lvup_standby=0;}});try{delete gfd.lvup_magic_flg;}catch(e){}break;case 1019:var mon=gfd.cards[q.target_id];var aMonsterData=gmd.m_monster[mon.monster_id];if(0 < mon.lvup_standby){mon.lvup_standby--;}else if(0 < gfd.lvup_assist){gfd.lvup_assist--;}else{throw new Error('invalid_target');}if(typeof q.param1 !='undefined'){var aSuperInHand=gfd.cards[q.param1];var bSuper=gfu.isValidSuper({aBefore:gfd.cards[q.target_id],aAfter:aSuperInHand,});if(!bSuper){throw new Error('invalid_target');}mon.next_game_card_id=q.param1;aSuperInHand.monster_id=gmd.m_card[aSuperInHand.card_id].monster_id;aSuperInHand=gfu.loadMonsterInfo({target_monster:aSuperInHand,pos_id:mon.pos_id,reset_hp:true,aBefore:gfd.cards[q.target_id],});}else if(typeof aMonsterData.next_monster_id !='undefined'){mon=gfu.loadMonsterInfo({target_monster:mon,monster_id:aMonsterData.next_monster_id,reset_hp:true,});}else{throw new Error('argument_error');}break;case 1020:var mon=gfd.cards[q.target_id];if(mon.lv <=1){throw new Error('invalid_target');}var bResolved=false;$.each(gmd.m_monster,function(i,val){if(val.next_monster_id==mon.monster_id){mon=gfu.loadMonsterInfo({target_monster:mon,monster_id:val.monster_id,reset_hp:true,});bResolved=true;return false;}});if(!bResolved){var aBefore=gfd.cards[mon.before_game_card_id];if(typeof aBefore.next_game_card_id !='undefined'){delete aBefore.next_game_card_id;}aBefore.hp=gfu.getMaxHP(aBefore);var iSortNo=1;$.each(gfd.cards,function(i,val){if(val.pos_category=='used'){if(iSortNo <=val.sort_no){iSortNo=val.sort_no+1;}}});mon.pos_category='used';mon.sort_no=iSortNo;}if(!q.param1){gfd.queues.push({actor_id:q.target_id,log_message:'レベルダウンしたストーンを還元',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1004,target_id:q.target_id,param1:1,}],});}break;case 1021:var mon=gfd.cards[q.target_id];mon=gfu.loadMonsterInfo({target_monster:mon,monster_id:q.param1,reset_hp:q.param2,});var sDom='#'+mon.pos_id+' div.pict';gfd.animation_info.animations.push({target_dom:sDom,html_param:'<img src="/images/card/'+gmd.m_monster[mon.monster_id].image_file_name+'" />',});gfd.animation_info.animations.push({target_dom:sDom+' img',css_param:{opacity:0,margin:'25px',height:0,width:0,},animation_param:{margin:0,height:'50px',width:'50px',opacity:1,},});break;case 1022:var p=gfu.getXYFromPosId(q.param1);var aCard=gfd.cards[q.target_id];if(aCard.status){if(aCard.status[114]){throw new Error('Move failed. Mover has kagenui.');}}if((aCard.owner=='my' && 2 <=p.y)||(aCard.owner=='enemy' && p.y <=1)){aCard.pos_id=q.param1;bMoveQueueResolved=true;var sDom='#'+q.param1;for(var i=0;i < 2;i++){gfd.animation_info.animations.push({target_dom:sDom,animation_param:{'background-color':'#ee0',},});gfd.animation_info.animations.push({target_dom:sDom,animation_param:{'background-color':g_base_color.background,},});}}else{throw new Error('move_to_opponent_field');}break;case 1023:var aCard=gfd.cards[q.target_id];if(!q.param1){q.param1=1;}if(aCard.owner=='my'){var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:'myMaster',});gfd.cards[iGameCardId].hp -=q.param1;}else if(aCard.owner=='enemy'){var iGameCardId=gfr.getGameCardId({pos_category:'field',pos_id:'enemyMaster',});gfd.cards[iGameCardId].hp -=q.param1;}break;case 1024:var mon=gfd.cards[q.target_id];var nMaxAct=gfu.getMaxActCount(mon.monster_id);if(mon.standby_flg){throw new Error('invalid_actor');}if(nMaxAct <=mon.act_count){throw new Error('already_acted');}mon.act_count++;gfr.actedReaction({actor_id:exec_act.actor_id,target_id:q.target_id,});break;case 1025:var mon=gfd.cards[q.target_id];var aCardData=gmd.m_card[mon.card_id];if(aCardData.category=='master'){throw new Error('invalid_target');}mon.status[100]={status_id:100,turn_count:1000,};break;case 1026:var mon=gfd.cards[q.target_id];if(q.param1=='madHole'){if(typeof mon.mad_hole_cnt=='number'){mon.mad_hole_cnt++;}else{mon.mad_hole_cnt=1;}break;}var aAlreadyStatus={};$.each(mon.status,function(iStatusId,val){var aSt=gmd.m_status[iStatusId];switch(aSt.status_type){case 'P':case 'S':aAlreadyStatus[aSt.status_type]=true;aAlreadyStatus[iStatusId]=true;break;default:aAlreadyStatus[iStatusId]=true;break;}});var aSt=gmd.m_status[q.param1];switch(aSt.status_type){case 'P':case 'S':if(aAlreadyStatus[aSt.status_type]){throw new Error('duplicate_status_type');}break;default:if(aAlreadyStatus[aSt.status_id]){throw new Error('duplicate_status_id');}break;}var iTurnCount=2;switch(q.param1){case 100:case 105:case 112:case 122:case 123:case 124:case 128:iTurnCount=1000;break;}mon.status[q.param1]={status_id:q.param1,turn_count:iTurnCount,};switch(q.param1){case 110:case 120:mon.status[q.param1].param1=q.param2;break;case 127:mon.status[q.param1].param1=mon.monster_id;mon.monster_id=q.param2;break;case 128:mon.status[q.param1].param1=mon.monster_id;mon.monster_id=gmd.m_card[2].monster_id;break;}break;case 1027:var mon=gfd.cards[q.target_id];if(!mon.status[q.param1]){throw new Error('no_target');}switch(q.param1){case 116:if(q.param2){gfd.queues.push({actor_id:mon.game_card_id,log_message:'ダークホールにより消滅',resolved_flg:0,priority:gmd.queue_priority['follow'],queue_units:[{queue_type_id:1008,target_id:mon.game_card_id,}],});}break;case 127:case 128:mon.monster_id=mon.status[q.param1].param1;break;}delete mon.status[q.param1];break;case 1028:gfd.cards[q.target_id].skill_disable_flg=1;break;case 1029:gfd.cards[q.target_id].skill_disable_flg=0;break;case 1030:gfd.cards[q.target_id].act_count=0;break;default:throw new Error('invalid_queue_type');break;}delete q.failure_flg;if(!q.cost_flg){bEffectQueueResolved=true;}}catch(e){if(q.cost_flg){throw e;}gfd=backupFieldWhileSingleQueueProcessing;}}if(!bEffectQueueResolved){throw new Error('no_q_resolved');}if(bMoveQueueResolved){if(gfr.isDuplicateFieldPos({field_data:gfd,})){throw new Error('duplicate_field_pos');}}delete exec_act.failure_flg;setTimeout(function(){execAnimation(bRecursive);},1);}catch(e){gfd=backupFieldWhileSingleActionProcessing;}setTimeout(function(){execAnimation(bRecursive);},1);}function execAnimation(bRecursive){function _execAnimationUnit(bRecursive){try{var iAnimationTime=parseInt($('[name=animation_speed]:checked').val());if(isNaN(iAnimationTime)|| iAnimationTime <=0){throw new Error('no_setting');}}catch(e){iAnimationTime=100;}if(0 < gfd.animation_info.animations.length){try{var aArgs=gfd.animation_info.animations.shift();if($(aArgs.target_dom).size()<=0){throw '';}if(typeof aArgs.html_param !='undefined'){$(aArgs.target_dom).html(aArgs.html_param);}if(typeof aArgs.css_param !='undefined'){$.each(aArgs.css_param,function(key,val){$(aArgs.target_dom).css(key,val);});}if(typeof aArgs.animation_time_rate !='undefined'){iAnimationTime *=aArgs.animation_time_rate;}$(aArgs.target_dom).animate(aArgs.animation_param,iAnimationTime,'linear',function(){_execAnimationUnit(bRecursive);});}catch(e){setTimeout(function(){_execAnimationUnit(bRecursive);},1);}}else{gfd.animation_info.bAnimationProcessing=false;$('#game_field td[style]').removeAttr('style');setTimeout(function(){gfr.updateField({field_data:gfd,});if(bRecursive){execQueue({resolve_all:true});}},1);}}if(!gfd.animation_info.bAnimationProcessing){gfd.animation_info.bAnimationProcessing=true;$('.actor').removeClass('actor');$('.target').removeClass('target');_execAnimationUnit(bRecursive);}else{return;}}function calcPow(actorId,targetId,pow){try{if(pow < 0){throw new Error('minus_power');}var act=gfd.cards[actorId];var target=gfd.cards[targetId];if(target==null){throw new Error('no_target');}if(target.status){if(typeof target.status[115] !='undefined'){if(Math.random()<=0.5){return 0;}}}if(act && act.status){if(typeof act.status[100] !='undefined'){gfd.queues.push({actor_id:targetId,log_message:'気合溜め解除',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:100,target_id:targetId,}],});}if(act.status[101] !=null){pow++;gfd.queues.push({actor_id:actorId,log_message:'パワーアップ効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:101,target_id:actorId,}],});}if(act.status[102] !=null){pow++;gfd.queues.push({actor_id:actorId,log_message:'バーサクパワー効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],queue_units:[{queue_type_id:1006,param1:1,target_id:actorId,},{queue_type_id:1027,param1:102,target_id:actorId,}],});}if(act.status[103] !=null){pow=2;gfd.queues.push({actor_id:actorId,log_message:'パワー２効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:103,target_id:actorId,}],});}if(act.status[104] !=null){if(pow > 0){pow--;}gfd.queues.push({actor_id:actorId,log_message:'パワーダウン効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:104,target_id:actorId,}],});}if(act.status[105] !=null){pow+=2;}}if(pow && gmd.m_card[target.card_id].category=='master'){pow -=2;if(pow < 0){pow=0;}}if(pow && target.status[106] !=null){pow--;}if(pow && target.status[107] !=null){pow /=2;gfd.queues.push({actor_id:targetId,log_message:'ガラスの盾 効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:107,target_id:targetId,}],});}if(pow && target.status[106] !=null){pow=parseInt(pow / 2);}if(pow && target.status[106] !=null){pow--;}if(pow && target.status[100] !=null){pow--;gfd.queues.push({actor_id:targetId,log_message:'気合溜め 防御効果発揮',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:100,target_id:targetId,}],});}if(pow < 0){throw new Error('minus_power');}}catch(e){switch(e){case 'no_target':case 'minus_power':return 0;default:throw e;}}return pow;}function calcDam(actorId,targetId,dam){try{if(dam < 0){throw new Error('minus_power');}var act=gfd.cards[actorId];var target=gfd.cards[targetId];if(target==null){throw new Error('no_target');}if(target.status){if(typeof target.status[115] !='undefined'){if(Math.random()<=0.5){return 0;}}}if(dam && target.status[100] !=null){gfd.queues.push({actor_id:targetId,log_message:'気合溜め解除',resolved_flg:0,priority:gmd.queue_priority['same_time'],actor_anime_disable:true,queue_units:[{queue_type_id:1027,param1:100,target_id:targetId,}],});}}catch(e){switch(e){case 'no_target':case 'minus_power':return 0;default:throw e;}}return dam;}function removeMonsterInfoOnField(target_id){var mon=gfd.cards[target_id];delete mon.monster_id;delete mon.pos_id;delete mon.hp;delete mon.standby_flg;delete mon.skill_disable_flg;delete mon.act_count;delete mon.lvup_standby;delete mon.status;delete mon.mad_hole_cnt;}function turnEndProc(){$.each(gfd.cards,function(i,val){if(typeof val.monster_id !='undefined'){var aMonsterData=gmd.m_monster[val.monster_id];switch(aMonsterData.skill.id){case 32:gfd.queues.push({actor_id:val.game_card_id,log_message:'仮死から復活',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1021,target_id:val.game_card_id,param1:val.monster_id - 1,param2:false,}],});break;}if(typeof val.status !='undefined'){$.each(val.status,function(status_id,val2){val2.turn_count--;if(val2.turn_count <=0){gfd.queues.push({actor_id:val.game_card_id,log_message:'',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1027,target_id:val.game_card_id,param1:status_id,}],});}});}if(val.owner=='my' && val.act_count < gfu.getMaxActCount(val.monster_id)&& !val.standby_flg){gfd.queues.push({actor_id:null,log_message:'',resolved_flg:0,priority:gmd.queue_priority['system'],queue_units:[{queue_type_id:1025,target_id:val.game_card_id,}],})}}});gfd.queues.push({actor_id:null,log_message:'ターンエンド',resolved_flg:0,priority:gmd.queue_priority['turn_end'],queue_units:[{queue_type_id:1000,}],});execQueue({resolve_all:true});}};
